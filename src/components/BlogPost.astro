---
import type { CollectionEntry } from 'astro:content';
import ResponsiveImage from './ResponsiveImage.astro';
import Prose from './Prose.astro';
import { formatDate } from '../utils/dates';

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;
const { title, pubDate, updatedDate, heroImage, heroCaption, tags, author } = post.data;
const formattedPubDate = formatDate(pubDate);
const formattedUpdateDate = updatedDate ? formatDate(updatedDate) : null;
---

<article class="mx-auto max-w-3xl">
  <header class="mb-8">
    <h1 class="mb-2 text-4xl font-bold">{title}</h1>
    <div class="mb-4 flex flex-wrap items-center gap-x-4 text-sm text-gray-600 dark:text-gray-400">
      <time datetime={pubDate.toISOString()}>
        Published {formattedPubDate}
      </time>
      {
        formattedUpdateDate && (
          <time datetime={updatedDate.toISOString()}>(Updated {formattedUpdateDate})</time>
        )
      }
      <span>by {author}</span>
    </div>
    {
      tags.length > 0 && (
        <div class="flex flex-wrap gap-2">
          {tags.map((tag: string) => (
            <a
              href={`/tags/${tag}`}
              class="rounded-full bg-gray-100 px-3 py-1 text-sm text-gray-700 hover:bg-gray-200 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700"
            >
              #{tag}
            </a>
          ))}
        </div>
      )
    }
  </header>

  {
    heroImage && (
      <figure class="mb-8">
        <div class="relative aspect-[2/1] overflow-hidden rounded-lg">
          <ResponsiveImage
            src={heroImage}
            alt={heroCaption || title}
            sizes="(min-width: 1024px) 768px, 100vw"
            class="object-cover"
          />
        </div>
        {heroCaption && (
          <figcaption class="mt-2 text-center text-sm text-gray-600 dark:text-gray-400">
            {heroCaption}
          </figcaption>
        )}
      </figure>
    )
  }

  <Prose>
    <slot />
  </Prose>

  <footer class="mt-8 border-t border-gray-200 pt-8 dark:border-gray-800">
    <div class="flex items-center justify-between">
      <div class="text-sm text-gray-600 dark:text-gray-400">
        Written by {author}
      </div>
      <a
        href="/blog"
        class="rounded-lg bg-gray-100 px-4 py-2 text-sm text-gray-700 hover:bg-gray-200 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700"
      >
        ‚Üê Back to Blog
      </a>
    </div>
  </footer>
</article>
